<!DOCTYPE html>
<html>
<head>
  <title>Wildfire Risk Map — Slide-in Panel</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { height: 100vh; width: 100%; }

    /* Side panel styles */
    #sidePanel {
      position: fixed;
      top: 0;
      right: -320px; /* hidden offscreen initially */
      width: 320px;
      height: 100%;
      background: white;
      box-shadow: -3px 0 10px rgba(0,0,0,0.3);
      padding: 20px;
      transition: right 0.3s ease;
      overflow-y: auto;
      z-index: 1000;
    }
    #sidePanel.open {
      right: 0;
    }
    #sidePanel h2 {
      margin-top: 0;
    }
    #closeBtn {
      cursor: pointer;
      border: none;
      background: none;
      font-size: 24px;
      position: absolute;
      top: 10px;
      right: 10px;
      color: #555;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <div id="sidePanel">
    <button id="closeBtn">&times;</button>
    <h2>Wildfire Risk Details</h2>
    <div id="riskInfo">Click a circle to see details.</div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    var canadaBounds = L.latLngBounds(
      L.latLng(35, -150),
      L.latLng(90, -40)
    );

    var map = L.map('map', {
      center: [56.1304, -106.3468],
      zoom: 4,
      minZoom: 4,
      maxZoom: 10,
      maxBounds: canadaBounds,
      maxBoundsViscosity: 1.0
    });

    map.on('drag', function() {
      map.panInsideBounds(canadaBounds, { animate: false });
    });

    map.createPane('riskPane');
    map.getPane('riskPane').style.zIndex = 650;

    L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      maxZoom: 18,
      attribution: 'Tiles © Esri'
    }).addTo(map);

    fetch('https://raw.githubusercontent.com/codeforgermany/click_that_hood/main/public/data/canada.geojson')
      .then(response => response.json())
      .then(data => {
        L.geoJSON(data, {
          style: {
            color: 'black',
            weight: 1.5,
            fillOpacity: 0
          }
        }).addTo(map);
      });

    var riskPoints = [
      [51.0, -114.0, 0.1],
      [52.0, -106.0, 0.3],
      [53.5, -113.5, 0.7],
      [50.0, -104.0, 0.9]
    ];

    function riskToColor(risk) {
      var r = Math.round(255 * risk);
      var g = Math.round(255 * (1 - risk));
      return 'rgb(' + r + ',' + g + ',0)';
    }

    var sidePanel = document.getElementById('sidePanel');
    var riskInfo = document.getElementById('riskInfo');
    var closeBtn = document.getElementById('closeBtn');

    closeBtn.onclick = function() {
      sidePanel.classList.remove('open');
      // Reset map view to center or keep current? Here we keep current
    };

    riskPoints.forEach(function(point) {
      var lat = point[0];
      var lon = point[1];
      var risk = point[2];
      var color = riskToColor(risk);

      var circle = L.circleMarker([lat, lon], {
        color: color,
        fillColor: color,
        fillOpacity: 0.8,
        radius: 10,
        pane: 'riskPane',
        interactive: true
      }).addTo(map);

      circle.on('click', function() {
        riskInfo.innerHTML = `
          <strong>Risk Level:</strong> ${Math.round(risk * 100)}%<br>
          <strong>Coordinates:</strong> ${lat.toFixed(4)}, ${lon.toFixed(4)}
        `;

        sidePanel.classList.add('open');

        map.flyTo([lat, lon], 8, { animate: true, duration: 1.5 });
      });
    });
  </script>
</body>
</html>
